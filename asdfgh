SELECT 
    m.merchant_name,
    COALESCE(c1.external_id, m.category_id) AS category_id,
    COALESCE(c1.name, c2.name) AS category_name
FROM merchants m
LEFT JOIN categories c1               -- case: merchant has parent id
       ON m.category_id = c1.id
LEFT JOIN categories c2               -- case: merchant already has external_id
       ON m.category_id = c2.external_id;


3733 красота и здоровье, 
3787 красота и здоровье, 
3810 Досуг и творчество, 
3761 продукты питания,  
lets just add them by hand i can find their

SELECT 
    m.merchant_name,
    COALESCE(c1.external_id, c2.external_id, cparent.external_id, m.category_id) AS category_id,
    COALESCE(c1.name, c2.name, cparent.name) AS category_name
FROM merchants m
LEFT JOIN categories c1
       ON m.category_id = c1.id
LEFT JOIN categories c2
       ON m.category_id = c2.external_id
LEFT JOIN categories cparent
       ON CASE m.category_id
              WHEN 3733 THEN 8
              WHEN 3787 THEN 8
              WHEN 3810 THEN 33119
              WHEN 3761 THEN 13
          END = cparent.id;



1
2
6
3
4
7
8
33819
32569
35891
10
9
33119
38133
32626
37072
34672
34729
13
12
31068
11
14
85589
5
39922
